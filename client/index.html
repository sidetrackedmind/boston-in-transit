<html ng-app>
  <head>
    <script>
      function Controller($scope) {
        var socket = io.connect();
        var lat = '';
        var long = '';
        
        $scope.last_updated = '';
        
        socket.on('update', function(data) {
          $scope.last_updated = data.date;
          lat = data.entities.vehicle.position.latitude;
          long = data.entities.vehicle.position.longitude;
          $scope.$apply();
          marker.setLatLng(L.latLng(lat,long));
        });
      }
    </script>
    <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
    <style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:50; bottom:0; width:80%; }
</style>
  </head>
  <body>
    <div class="container" ng-controller="Controller">
      <p ng-bind="last_updated"></p>
    </div>
    <div id='map'></div>
    <script>
      L.mapbox.accessToken = 'pk.eyJ1IjoiZ3JlZW50IiwiYSI6ImNpazBqdWFsOTM5Nnh2M2x6dWZ2dnB3aHkifQ.97-pFPD8lQf02B6edag1rA';
      var map = L.mapbox.map('map', 'mapbox.streets')
          .setView([42.358056, -71.063611], 10);
      var marker = L.marker([42.358056, -71.063611], {
          icon: L.mapbox.marker.icon({
            'marker-color': '#f86767'
          })
      });
      
      marker.addTo(map);
    </script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/angular.min.js"></script>
  </body>
</html>
